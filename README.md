# MaiMbot一键启动V3.0版-适配0.6.2
当前一键启动程序适配最新的0.6.2版本的麦麦，若后续麦麦的启动原理相同，则同样适配。

# 使用说明
你可以把这个文件放在任何地方!
推荐放在**MaiM-with-u**文件夹中，
**首次运行请选择配置内容**，输入**麦麦本体文件夹地址、适配器文件夹地址和.env文件地址（就是配置麦麦时用的哪个.env文件）**，
配置完成后会生成一个**config.ini**文件用来存储配置。

**第二次运行时选择启动麦麦**即可。

如果有BUG，请检查你设置的**执行策略**是否过高，以及确保你有**权限**访问相应的文件夹。
如果还不行，

上上策是询问智慧的小草神，

上策是询问万能的千石可乐，

中策是不用，

下策是询问@joker或@万迦（可能会被弔一顿），

下下策是询问一个废物（@小城之雪），

# 交流与分享
对麦麦部署有疑问的，可以来我的**麦麦答疑群（1025509724）**（本群禁止接入麦麦），这里不仅有顶级大佬帮你解决问题（还是推荐自己看文档解决），还可以在这里交流分享大家的知识库。

你也可以在**麦麦交流群（902093437）** 接入自己的麦麦进行测试与调整。

同时我也会在**B站**发布部署和配置麦麦的教程。
**B站主页链接：** https://space.bilibili.com/3546384380725382

# 更新日志
> # V1.0：
**主要：** 修复了原启动方式不够降智的BUG。次要：添加多种修复兼启动方式。

**V1.1：**
**主要** 修复了妃物群主（@小城之雪）智商太高的BUG。

**次要** 修复了一键启动的目标文件检索问题。

**新增** 无论何种（完全变量或基础变量）方式，麦麦运行成功一次后，第二次运行麦麦仅需双击一键启动文件夹中的run_both.bat文件即可。

> # V2.0：
**主要：** 进一步修复了配置及启动时不够降智的BUG。
**次要：** 修复了启动时只启动了一个窗口的问题，将繁琐的配置精简。

> 模块化配置管理：
- 使用独立的config.ini文件存储配置
- 配置与代码分离，方便分享和修改
  
> 智能路径验证：
- 自动验证路径是否存在
- 支持带空格的路径（无需手动加引号）
  
> 容错机制：
- 输入验证循环直到输入有效值
- 自动检测配置文件完整性
- 友好的错误提示和恢复机制
  
> 用户体验优化：
- 保留命令窗口查看运行状态
- 清晰的步骤提示和进度反馈
  
> 兼容性增强：
- 强制使用UTF-8编码
- 兼容不同目录结构
- 自动处理虚拟环境路径
  
 **V2.1:**
- 修复了带空格或特殊字符的路径有时会出BUG的问题。
  
 > 新功能：
- 现在配置内容时，可以直接将文件夹或文件拖拽进配置窗口以复制文件路径。

# V3.0：

> 一、功能扩展

1. 新增启动选项：旧版本仅支持“运行麦麦”和“配置内容”两个基础功能；新版本新增“运行麦麦（同时启动NapCatQQ并检查Mongo DB）”选项，可自动检测NapCatQQ运行状态与MongoDB服务状态，并根据情况执行启动或提示操作，功能更加全面。
2. 新增退出功能：新版本添加“退出程序”选项，方便用户直接关闭程序，旧版本无此直接退出功能，需手动关闭窗口。
3.  NapCatQQ路径支持：新版本对NapCatQQ程序路径的处理更灵活，支持路径为空的情况，并在启动时进行针对性检查和提示；旧版本未涉及该程序路径相关操作。

 

> 二、交互优化

1. 菜单界面：新版本菜单更清晰美观，使用字母A - D作为选项标识，且新增横线、等号分隔元素；旧版本使用数字1、2作为选项，界面相对简洁。
2. 路径输入：新版本支持将文件夹或路径直接拖入窗口完成输入，无需手动加引号；旧版本仅通过手动输入路径方式，对含空格等特殊字符路径处理不够便捷。

> 三、逻辑与稳定性提升

1. 错误处理：新版本在错误提示方面更详细，如在选择B选项时，对NapCatQQ和MongoDB的不同状态均有对应提示；运行麦麦时，各步骤错误均有明确回显，且窗口保持打开便于查看问题。旧版本错误提示相对简单，部分场景下可能无法清晰展示错误原因。
2. 编码设置：新版本明确设置为UTF - 8编码，从根源上避免菜单界面乱码问题；旧版本虽通过`chcp 65001`尝试解决编码问题，但在复杂场景下仍可能出现乱码。
3. 参数处理：新版本在参数传递和处理上更严谨，减少类似“无法将参数绑定到参数‘FilePath’，因为该参数是空值”等问题；旧版本在复杂路径或参数传递时可能存在潜在逻辑漏洞 。

 

> 四、技术实现差异

1. 脚本语言：旧版本基于批处理（.bat）编写；新版本采用PowerShell编写，利用PowerShell强大的系统交互与脚本功能，可更方便地实现任务管理（如检查进程）、服务状态查询（如MongoDB服务）等操作。

### 麦麦启动器详细使用说明

> 一、程序概述

麦麦启动器是一款便捷工具，旨在简化麦麦程序的启动流程，并集成相关程序的启动与配置管理功能。用户通过选择不同选项，可实现麦麦程序的单独启动、麦麦与相关程序协同启动，以及自定义程序运行所需的各类路径配置。

> 二、运行环境要求

**操作系统**：

- [ ] Windows 10 或 Windows 11 系统。

**软件依赖**

- [ ] 系统已正确安装 PowerShell 且支持 UTF-8 编码。

- [ ] 已安装 Python 环境，确保能够运行麦麦程序及其相关脚本。

- [ ] 麦麦程序运行所需的 Python 依赖库已安装（在选择启动麦麦时，程序会自动检查并安装缺失的依赖库，包括 python-dotenv、loguru、Pillow、pymongo、python-dateutil、tomlkit、packaging、jieba ）。

- [ ] 若涉及 MongoDB 服务相关操作，需提前正确配置并安装 MongoDB 服务 。

> 三、使用步骤

- [ ] **（一）启动程序**

双击 .exe 可执行文件，打开麦麦启动器控制台，界面显示如下菜单：

```
麦麦启动器控制台
——————————
选择选项
================
 [A]运行麦麦
 [B]运行麦麦（同时启动NapCatQQ和Mongo DB）
 [C]配置内容（覆盖先前配置或新建配置）
 [D]退出程序
================

```
- [ ] **（二）配置内容（选择 C）**

**输入路径：** 按提示依次输入麦麦本体所在目录路径、适配器本体所在目录路径、.env** 文件路径和 NapCatQQ 程序路径（该路径可留空）。你可以直接将文件夹或文件拖入控制台窗口来快速输入路径 ，无需手动添加引号。

**路径检查：**程序会自动检查输入路径中是否包含中文，若存在中文，将提示重新输入。

1. 对于目录路径，会验证其是否在计算机中实际存在；对于 .env 文件路径和 NapCatQQ 程序路径，会验证路径有效性，以及 NapCatQQ 程序路径对应的目标是否为 .exe 文件。若路径不满足要求，均需重新输入。

2. 保存配置：完成所有路径输入且验证通过后，程序自动保存配置，并提示 “配置内容已保存，正在启动麦麦...”，随后开始启动麦麦程序。

- [ ] **（三）运行麦麦（选择** A）

- 程序检查已配置的麦麦本体路径、适配器本体路径和 .env 文件路径。

- 若路径存在中文、为空，或 .env 文件不存在，将提示 “路径配置错误，请重新配置！” 或 “.env 文件不存在，请重新配置！” ，需重新配置路径。

**若路径配置正确，程序同时启动两个 PowerShell 窗口：**

- 一个窗口在麦麦本体目录中，激活虚拟环境，安装缺失依赖库，调用 .env 文件变量，运行 python.\bot.py 脚本，并显示运行回显。

- 另一个窗口在适配器本体目录中，激活虚拟环境，运行 python.\main.py 脚本，并显示运行回显。

- 两个窗口保持打开状态，运行成功后显示 “麦麦启动成功！” 。若运行中出现错误，窗口不会关闭，以便查看错误信息。

- [ ] **（四）运行麦麦（同时启动 NapCatQQ 和 Mongo DB）（选择 B）**

- 检查 NapCatQQ 状态：程序先在任务管理器中检查是否有名为 “NapCatWinBootMain” 的任务在运行。若已启动，提示 “NapCatQQ 已启动！正在检查 Mong DB！” ；若未启动，检查配置文件中的 NapCatQQ 程序路径，若为空，提示 “NapCatQQ 程序路径为空，无法启动，正在检查 Mongo DB” ，若存在路径，则启动 NapCatQQ 程序，并提示 “NapCat 启动成功！正在检查 Mongo DB” 。

- 检查 MongoDB 服务状态：检查系统服务中的 “MongoDB” 服务是否已启动。若已启动，提示 “MongoDB 已启动！正在启动麦麦！” ；若未启动，提示 “Mongo DB 未启动，请手动启动！正在启动麦麦！” 。

- 启动麦麦：完成上述检查后，按与选择 A 时相同的流程检查路径配置并启动麦麦程序 。

- [ ] **（五）退出程序（选择 D）**

- 选择该选项后，直接关闭麦麦启动器控制台窗口，退出程序。

> 四、注意事项

- 输入路径时，尽量避免使用包含特殊字符（除空格外）的路径，以免出现不可预见的问题。

- 若在运行过程中出现错误提示，仔细查看错误信息，按提示检查路径配置、软件依赖等是否正确，必要时重新配置或安装相关软件。

- 启动程序过程中，请勿随意关闭自动打开的 PowerShell 窗口，以免影响程序正常运行。

# MaiMbot-Chat

**促进多元化艺术创作发展普及**
